# 项目功能流程图

本文档包含了 `MuseumDisplay` 项目各主要功能的业务流程图。

## 1. 用户认证模块

### 1.1 登录流程
**涉及类**: [LoginController](file:///e:/github_repos/JavaPractice/MuseumDisplay/src/main/java/museum/controller/LoginController.java#15-67), [UserService](file:///e:/github_repos/JavaPractice/MuseumDisplay/src/main/java/museum/service/UserService.java#13-115)

```mermaid
graph TD
    A[用户打开登录界面] --> B(输入用户名和密码)
    B --> C{点击登录}
    C --> D[LoginController 获取输入]
    D --> E[调用 UserService.login]
    E --> F{"验证输入是否为空?"}
    F -- 是 --> G[抛出 ValidationException]
    G --> H[显示警告弹窗]
    F -- 否 --> I{"查询数据库验证凭据?"}
    I -- 失败 --> J[抛出 AuthenticationException]
    J --> K[显示错误弹窗]
    I -- 成功 --> L[登录成功]
    L --> M[SessionManager 保存当前用户]
    M --> N{"用户是管理员?"}
    N -- 是 --> O[跳转至管理员仪表盘]
    N -- 否 --> P[跳转至用户主仪表盘]
```

### 1.2 注册流程
**涉及类**: [RegisterController](file:///e:/github_repos/JavaPractice/MuseumDisplay/src/main/java/museum/controller/RegisterController.java#14-68), [UserService](file:///e:/github_repos/JavaPractice/MuseumDisplay/src/main/java/museum/service/UserService.java#13-115)

```mermaid
graph TD
    A[用户打开注册界面] --> B(输入用户名, 密码, 确认密码, 邮箱)
    B --> C{点击注册}
    C --> D[RegisterController 获取输入]
    D --> E[调用 UserService.register]
    E --> F{"验证输入有效性?"}
    F -- "无效(空值/密码不匹配)" --> G[抛出 ValidationException]
    G --> H[显示错误弹窗]
    F -- 有效 --> I{"用户名是否存在?"}
    I -- 是 --> J[抛出 ValidationException]
    J --> H
    I -- 否 --> K[创建新用户并保存至数据库]
    K --> L[注册成功]
    L --> M[显示成功提示]
    M --> N[跳转至登录界面]
```

## 2. 用户主面板模块

### 2.1 浏览与搜索流程
**涉及类**: [MainDashboardController](file:///e:/github_repos/JavaPractice/MuseumDisplay/src/main/java/museum/controller/MainDashboardController.java#21-157), `HeritageService`, `ArchitectureService`

```mermaid
graph TD
    A[用户进入主仪表盘] --> B[初始化数据]
    B --> C[调用 HeritageService.getAllHeritage]
    B --> D[调用 ArchitectureService.getAllArchitecture]
    C & D --> E[展示非遗和古建筑列表]
    
    A --> F{"用户输入搜索关键词"}
    F --> G[点击搜索]
    G --> H[调用 Service 执行搜索]
    H --> I[更新列表显示结果]
    
    A --> J{"筛选显示视图"}
    J -- "显示全部" --> K[显示两个列表区域]
    J -- "仅看古建筑" --> L[隐藏非遗列表]
    J -- "仅看非遗" --> M[隐藏古建筑列表]
```

### 2.2 查看详情流程
**涉及类**: [MainDashboardController](file:///e:/github_repos/JavaPractice/MuseumDisplay/src/main/java/museum/controller/MainDashboardController.java#21-157), `HeritageDetailController`, `ArchitectureDetailController`

```mermaid
graph TD
    A[用户在列表中查看项目] --> B{"双击某一行?"}
    B -- 是 --> C[获取选中对象]
    C --> D{"对象类型?"}
    D -- Heritage --> E[弹出非遗详情窗口]
    D -- Architecture --> F[弹出古建筑详情窗口]
    E --> G[HeritageDetailController 显示详情]
    F --> H[ArchitectureDetailController 显示详情]
```

## 3. 管理员面板模块

管理员面板主要负责内容的增删改查（CRUD）。

### 3.1 非遗与古建筑管理 (CRUD)
**涉及类**: [AdminDashboardController](file:///e:/github_repos/JavaPractice/MuseumDisplay/src/main/java/museum/controller/AdminDashboardController.java#28-486), `HeritageService`, `ArchitectureService`

```mermaid
graph TD
    A[管理员进入仪表盘] --> B[初始化加载数据表]
    B --> C[展示非遗表和古建筑表]
    
    A --> D{"选择操作"}
    
    D -- "搜索" --> E[输入关键词并搜索]
    E --> F[更新表格数据]
    
    D -- "添加" --> G[点击添加按钮]
    G --> H[弹出输入对话框]
    H --> I[管理员输入信息并上传图片]
    I --> J{点击保存}
    J --> K[验证数据]
    K -- 有效 --> L[调用 Service.create]
    L --> M[刷新表格数据]
    K -- 无效 --> N[显示错误提示]
    
    D -- "编辑" --> O[双击表格行]
    O --> P["弹出编辑对话框(预填数据)"]
    P --> Q[管理员修改信息]
    Q --> R{点击保存}
    R --> S[调用 Service.update]
    S --> T[刷新表格数据]
    
    D -- "删除" --> U[选中表格行并点击删除]
    U --> V{"确认删除?"}
    V -- 是 --> W[调用 Service.delete]
    W --> X[刷新表格数据]
    V -- 否 --> Y[取消操作]
    
    D -- "登出" --> Z[清除 Session 并返回登录页]
```
